(this["webpackJsonpkamatama-jisho"]=this["webpackJsonpkamatama-jisho"]||[]).push([[0],{28:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){},36:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n(1),c=n(17),i=n.n(c),s=(n(28),n(37)),o=n(2),u=n.n(o),l=n(3),f=n(15),h=n(21),d=function(){var e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.a)("kamatama",1,{upgrade:function(){var e=Object(l.a)(u.a.mark((function e(t,n,r){var a,c,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Upgrading database to version ".concat(r,".")),a=t.createObjectStore("allKanji",{keyPath:"literal"}),c=t.createObjectStore("allPhrases",{keyPath:"sequenceNumber"}),(i=t.createObjectStore("queryStore",{keyPath:"sequenceNumber"})).createIndex("exact","exact",{multiEntry:!0}),i.createIndex("partial","partial",{multiEntry:!0}),e.next=8,Promise.all([a,c,i].map((function(e){return e.transaction.done}))).catch(console.error);case 8:console.log("Database upgraded to version ".concat(r));case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),b=n(5),p=(n(13),n(18),n(9));n(14),n(22);var v=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)),j=new Promise((function(e){window.addEventListener("load",(function t(){e(),window.removeEventListener("load",t)}))}));function m(e){if("serviceWorker"in navigator){if(new URL("/kamatama",window.location.href).origin!==window.location.origin)return;j.then((function(){var t="".concat("/kamatama","/service-worker.js");v?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):O(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):O(t,e)}))}}function O(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}function g(){return(g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function x(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var y=a.createElement("g",null,a.createElement("circle",{id:"White",cx:512,cy:512,r:507,fill:"#ffffff",stroke:"#cccccc",strokeWidth:10}),a.createElement("circle",{id:"Yolk",cx:512,cy:512,r:200,fill:"#ffb43b"}));function w(e,t){var n=e.title,r=e.titleId,c=x(e,["title","titleId"]);return a.createElement("svg",g({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",ref:t,"aria-labelledby":r},c),n?a.createElement("title",{id:r},n):null,y)}var k=a.forwardRef(w),E=(n.p,n(31),function(){var e=Object(a.useState)(!0),t=Object(f.a)(e,2),n=t[0],c=t[1],i="serviceWorker"in navigator,s=Object(a.useState)(null),o=Object(f.a)(s,2),h=o[0],b=o[1];Object(a.useEffect)((function(){i?null===navigator.serviceWorker.controller?c(!1):d().then(function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.count("allKanji");case 2:return n=e.sent,e.next=5,t.count("allPhrases");case 5:r=e.sent,(n<13108||r<190269)&&c(!1);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()):c(!1)}),[i]),Object(a.useEffect)((function(){var e=function(e){e.preventDefault(),b(e)};return window.addEventListener("beforeinstallprompt",e),function(){window.removeEventListener("beforeinstallprompt",e)}}),[]);var p=Object(a.useCallback)((function(){m({onSuccess:function(){c(!0)}}),h&&!window.matchMedia("(display-mode: standalone)").matches&&h.prompt().catch(console.error)}),[h]);return Object(r.jsxs)("div",{className:["Landing",n&&"installed"].filter(Boolean).join(" "),children:[Object(r.jsxs)("div",{className:"content",children:[Object(r.jsx)("h1",{children:"\u3053\u3093\u306b\u3061\u306f!"}),Object(r.jsx)("p",{children:"This is Kamatama Jisho, a Japanese-English phrase book powered by the web!"}),i?Object(r.jsx)("p",{children:"To install Kamatama Jisho, just press the big egg down below."}):Object(r.jsxs)("p",{children:["Uh oh! The device you are using is not capable of installing"," ",Object(r.jsx)("a",{href:"https://en.wikipedia.org/wiki/Progressive_web_application",children:"PWAs"}),". Perhaps try a different device, or a different browser!"]})]}),i&&Object(r.jsx)("button",{className:"icon",onClick:p,children:Object(r.jsx)(k,{})})]})}),P=n(19),N=n(20),S=n(4),q=new(function(){function e(){Object(P.a)(this,e),this.query=void 0,this.loadingResults=void 0,this.request=void 0,this.results=void 0,this.dbPromise=void 0,this.entry=void 0,this.currentEntry=void 0,Object(S.c)(this),this.query="",this.loadingResults=!1,this.results=[],this.request=0,this.entry=0,this.dbPromise=d()}return Object(N.a)(e,[{key:"setQuery",value:function(e){this.query=e instanceof Function?e(this.query):e,this.fetchResults(Object(p.toHiragana)(this.query,{passRomaji:!0}))}},{key:"setCurrentEntry",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r,a,c,i=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==t){e.next=3;break}return Object(S.d)((function(){i.currentEntry=void 0})),e.abrupt("return");case 3:return n=++this.entry,e.next=6,this.dbPromise;case 6:return r=e.sent,a=r.transaction("allPhrases"),e.next=10,a.store.get(t);case 10:c=e.sent,this.entry===n&&Object(S.d)((function(){i.currentEntry=c}));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchResults",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r,a,c,i,s=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==t){e.next=3;break}return Object(S.d)((function(){s.results=[]})),e.abrupt("return");case 3:return n=++this.request,r=new Set,e.next=7,this.fetchExactSequenceNumbers(t,r);case 7:return e.next=9,this.fetchPartialSequenceNumbers(t,r);case 9:return e.next=11,this.dbPromise;case 11:return a=e.sent,c=a.transaction("allPhrases"),i=[],e.next=16,Promise.all(Array.from(r).map(function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.store.get(t);case 2:n=e.sent,i.push(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 16:n===this.request&&Object(S.d)((function(){s.results=i}));case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchExactSequenceNumbers",value:function(){var e=Object(l.a)(u.a.mark((function e(t,n){var r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dbPromise;case 2:return r=e.sent,a=r.transaction("queryStore"),e.next=6,a.store.index("exact").getAll(t).then((function(e){e.forEach((function(e){var t=e.sequenceNumber;n.add(t)}))}));case 6:return e.next=8,a.done;case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchPartialSequenceNumbers",value:function(){var e=Object(l.a)(u.a.mark((function e(t,n){var r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dbPromise;case 2:return r=e.sent,a=r.transaction("queryStore"),e.next=6,Promise.all([a.store.index("exact").getAll(IDBKeyRange.bound(t,t+"\uffff"),30).then((function(e){e.forEach((function(e){var t=e.sequenceNumber;n.add(t)}))})),a.store.index("partial").getAll(IDBKeyRange.bound(t,t+"\uffff"),30).then((function(e){e.forEach((function(e){var t=e.sequenceNumber;n.add(t)}))}))]);case 6:return e.next=8,a.done;case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}()),R=n(7),C=(n(32),Object(s.a)((function(e){var t=e.sequenceNumber,n=e.reading,a=e.kanji,c=e.sense;return Object(r.jsxs)("li",{className:"ResultListItem",onClick:function(){q.setCurrentEntry(t),console.log(n[0].value)},children:[Object(r.jsx)("div",{className:"forms",children:[].concat(Object(b.a)(a),Object(b.a)(n)).sort((function(e,t){return e.priority.length-t.priority.length})).map((function(e){return e.value})).join("\u3001")}),Object(r.jsx)("div",{className:"meanings",children:c.flatMap((function(e){return e.glossary})).map((function(e){return e.value})).join(", ")})]})}))),W=Object(s.a)((function(){var e=q.results;return Object(r.jsx)("ul",{className:"ResultList",children:e.map((function(e){return Object(r.jsx)(C,Object(R.a)({},e),e.sequenceNumber)}))})})),I=n.p+"static/media/icon.b8f19d44.svg",L=(n(33),Object(s.a)((function(){var e=Object(a.useRef)(null);Object(a.useEffect)((function(){var t;null===(t=e.current)||void 0===t||t.focus()}),[]);var t=Object(a.useCallback)((function(e){q.setQuery(e.target.value)}),[]);return Object(r.jsxs)("div",{className:"SearchBar",children:[Object(r.jsx)("img",{className:"icon",src:I,alt:"icon"}),Object(r.jsx)("input",{ref:e,type:"text",value:q.query,onChange:t,placeholder:"Search here..."}),Object(r.jsx)("button",{className:"Radicals",children:"\u5b57"})]})}))),A=(n(34),n(35),Object(s.a)((function(){var e=q.currentEntry,t=Object(a.useRef)();Object(a.useEffect)((function(){t.current=e}),[e]);var n=e||t.current;return Object(r.jsxs)("div",{className:["Phrase",e&&"valid"].filter(Boolean).join(" "),children:[Object(r.jsx)("button",{onClick:function(){return q.setCurrentEntry(-1)},children:"close"}),Object(r.jsx)("pre",{children:JSON.stringify(n,null,2)})]})}))),B=Object(s.a)((function(){return Object(r.jsxs)("div",{className:"App",children:[Object(r.jsx)(E,{}),Object(r.jsx)(A,{}),Object(r.jsx)(L,{}),Object(r.jsx)(W,{results:q.results})]})})),T=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,38)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};i.a.render(Object(r.jsx)(a.StrictMode,{children:Object(r.jsx)(B,{})}),document.getElementById("root")),T()}},[[36,1,2]]]);
//# sourceMappingURL=main.3d5d869b.chunk.js.map