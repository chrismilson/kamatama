(this["webpackJsonpkamatama-jisho"]=this["webpackJsonpkamatama-jisho"]||[]).push([[0],{41:function(e,t,n){},42:function(e,t,n){},49:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(0),c=n(29),i=n.n(c),s=(n(41),n(13)),o=n(3),u=n(26),l=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)),f=new Promise((function(e){window.addEventListener("load",(function(){e()}))}));function h(e){if("serviceWorker"in navigator){if(new URL("/kamatama",window.location.href).origin!==window.location.origin)return;f.then((function(){var t="".concat("/kamatama","/service-worker.js");l?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):d(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):d(t,e)}))}}function d(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function j(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=a.createElement("g",null,a.createElement("circle",{id:"White",cx:512,cy:512,r:507,fill:"#ffffff",stroke:"#cccccc",strokeWidth:10}),a.createElement("circle",{id:"Yolk",cx:512,cy:512,r:200,fill:"#ffb43b"}));function v(e,t){var n=e.title,r=e.titleId,c=j(e,["title","titleId"]);return a.createElement("svg",b({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",ref:t,"aria-labelledby":r},c),n?a.createElement("title",{id:r},n):null,p)}var m=a.forwardRef(v),O=(n.p,n(42),function(){var e=Object(a.useState)(!1),t=Object(u.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(null),s=Object(u.a)(i,2),l=s[0],f=s[1],d=Object(o.f)();Object(a.useEffect)((function(){"serviceWorker"in navigator&&c(!0)}),[]),Object(a.useEffect)((function(){var e=function(e){e.preventDefault(),f(e)};return window.addEventListener("beforeinstallprompt",e),function(){window.removeEventListener("beforeinstallprompt",e)}}),[]);var b=Object(a.useCallback)((function(){h({onSuccess:function(){d.push("/")}}),l&&!window.matchMedia("(didsplay-mode: standalone)").matches&&l.prompt().catch(console.error)}),[l,d]);return Object(r.jsxs)("div",{className:"Landing",children:[Object(r.jsxs)("div",{className:"content",children:[Object(r.jsx)("h1",{children:"\u3053\u3093\u306b\u3061\u306f!"}),Object(r.jsx)("p",{children:"This is Kamatama Jisho, a Japanese-English phrase book powered by the web!"}),n?Object(r.jsx)("p",{children:"To install Kamatama Jisho, just press the big egg down below."}):Object(r.jsxs)("p",{children:["Uh oh! The device you are using is not capable of installing"," ",Object(r.jsx)("a",{href:"https://en.wikipedia.org/wiki/Progressive_web_application",children:"PWAs"}),". Perhaps try a different device, or a different browser!"]})]}),n&&Object(r.jsx)("button",{className:"icon",onClick:b,children:Object(r.jsx)(m,{})})]})}),x=n(52),g=n(2),w=n.n(g),y=n(5),k=n(31),P=n(32),N=n(9),S=n(17),q=n(34),E=n(11);n(24),n(33),n(25),n(35);var R=function(){var e=Object(y.a)(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(q.a)("kamatama",1,{upgrade:function(){var e=Object(y.a)(w.a.mark((function e(t,n,r){var a,c,i;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Upgrading database to version ".concat(r,".")),a=t.createObjectStore("allKanji",{keyPath:"literal"}),c=t.createObjectStore("allPhrases",{keyPath:"sequenceNumber"}),(i=t.createObjectStore("queryStore",{keyPath:"sequenceNumber"})).createIndex("exact","exact",{multiEntry:!0}),i.createIndex("partial","partial",{multiEntry:!0}),e.next=8,Promise.all([a,c,i].map((function(e){return e.transaction.done}))).catch(console.error);case 8:console.log("Database upgraded to version ".concat(r));case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()});case 2:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=new(function(){function e(){Object(k.a)(this,e),this.query=void 0,this.loadingResults=void 0,this.results=void 0,this.request=void 0,this.dbPromise=void 0,Object(N.c)(this),this.query="",this.loadingResults=!1,this.results=[],this.request=0,this.dbPromise=R()}return Object(P.a)(e,[{key:"setQuery",value:function(e){this.query=e instanceof Function?e(this.query):e;var t=Object(S.toHiragana)(this.query,{passRomaji:!0});this.fetchResults(t)}},{key:"fetchResults",value:function(){var e=Object(y.a)(w.a.mark((function e(t){var n,r,a,c,i,s=this;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==t){e.next=3;break}return Object(N.d)((function(){s.results=[]})),e.abrupt("return");case 3:return n=++this.request,r=new Set,e.next=7,this.fetchExactSequenceNumbers(t,r);case 7:return e.next=9,this.fetchPartialSequenceNumbers(t,r);case 9:return e.next=11,this.dbPromise;case 11:return a=e.sent,c=a.transaction("allPhrases"),i=[],e.next=16,Promise.all(Array.from(r).map(function(){var e=Object(y.a)(w.a.mark((function e(t){var n;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.store.get(t);case 2:n=e.sent,i.push(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 16:n===this.request&&Object(N.d)((function(){s.results=i}));case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchExactSequenceNumbers",value:function(){var e=Object(y.a)(w.a.mark((function e(t,n){var r,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dbPromise;case 2:return r=e.sent,a=r.transaction("queryStore"),e.next=6,a.store.index("exact").getAll(t).then((function(e){e.forEach((function(e){var t=e.sequenceNumber;n.add(t)}))}));case 6:return e.next=8,a.done;case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchPartialSequenceNumbers",value:function(){var e=Object(y.a)(w.a.mark((function e(t,n){var r,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dbPromise;case 2:return r=e.sent,a=r.transaction("queryStore"),e.next=6,Promise.all([a.store.index("exact").getAll(IDBKeyRange.bound(t,t+"\uffff"),30).then((function(e){e.forEach((function(e){var t=e.sequenceNumber;n.add(t)}))})),a.store.index("partial").getAll(IDBKeyRange.bound(t,t+"\uffff"),30).then((function(e){e.forEach((function(e){var t=e.sequenceNumber;n.add(t)}))}))]);case 6:return e.next=8,a.done;case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}()),I=n(15),L=(n(49),function(e){var t=e.reading,n=e.kanji,a=e.sense;return Object(r.jsxs)("li",{className:"ResultListItem",children:[Object(r.jsx)("div",{className:"forms",children:[].concat(Object(E.a)(n),Object(E.a)(t)).sort((function(e,t){return e.priority.length-t.priority.length})).map((function(e){return e.value})).join("\u3001")}),Object(r.jsx)("div",{className:"meanings",children:a.flatMap((function(e){return e.glossary})).map((function(e){return e.value})).join(", ")})]})}),A=Object(x.a)((function(){var e=W.results;return Object(r.jsx)("ul",{className:"ResultList",children:e.map((function(e){return Object(r.jsx)(L,Object(I.a)({},e),e.sequenceNumber)}))})})),C=n.p+"static/media/icon.b8f19d44.svg",B=(n(50),Object(x.a)((function(){var e=Object(a.useRef)(null);Object(a.useEffect)((function(){var t;null===(t=e.current)||void 0===t||t.focus()}),[]);var t=Object(a.useCallback)((function(e){W.setQuery(e.target.value)}),[]);return Object(r.jsxs)("div",{className:"SearchBar",children:[Object(r.jsx)(s.b,{to:"/install",children:Object(r.jsx)("img",{className:"icon",src:C,alt:"icon"})}),Object(r.jsx)("input",{ref:e,type:"text",value:W.query,onChange:t,placeholder:"Search here..."}),Object(r.jsx)("button",{className:"Radicals",children:"\u5b57"})]})}))),T=Object(x.a)((function(){return Object(r.jsxs)("div",{className:"Home",children:[Object(r.jsx)(B,{}),Object(r.jsx)(A,{results:W.results})]})})),D=function(){return Object(r.jsx)("div",{className:"Phrase",children:"Moo"})},F=function(){return Object(a.useEffect)((function(){}),[]),Object(r.jsx)(s.a,{basename:"/kamatama",children:Object(r.jsxs)(o.c,{children:[Object(r.jsx)(o.a,{path:"/install",children:Object(r.jsx)(O,{})}),Object(r.jsx)(o.a,{path:"/phrase",children:Object(r.jsx)(D,{})}),Object(r.jsx)(o.a,{path:"/",children:Object(r.jsx)(T,{})})]})})},J=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,53)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};i.a.render(Object(r.jsx)(a.StrictMode,{children:Object(r.jsx)(F,{})}),document.getElementById("root")),J()}},[[51,1,2]]]);
//# sourceMappingURL=main.c6a37dfb.chunk.js.map