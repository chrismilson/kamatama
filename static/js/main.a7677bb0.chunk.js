(this["webpackJsonpkamatama-jisho"]=this["webpackJsonpkamatama-jisho"]||[]).push([[0],{29:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n(1),c=n(18),s=n.n(c),i=(n(29),n(38)),o=n(2),u=n.n(o),l=n(3),f=n(12),b=n(22),h=function(){var e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.a)("kamatama",1,{upgrade:function(){var e=Object(l.a)(u.a.mark((function e(t,n,r){var a,c,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Upgrading database to version ".concat(r,".")),a=t.createObjectStore("allKanji",{keyPath:"literal"}),c=t.createObjectStore("allPhrases",{keyPath:"sequenceNumber"}),(s=t.createObjectStore("queryStore",{keyPath:"sequenceNumber"})).createIndex("exact","exact",{multiEntry:!0}),s.createIndex("partial","partial",{multiEntry:!0}),e.next=8,Promise.all([a,c,s].map((function(e){return e.transaction.done}))).catch(console.error);case 8:console.log("Database upgraded to version ".concat(r));case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=n(5),d=n(15),v=n(16),j=n.n(v),x=n(10),m=n(8),O=n(23),g=n(19);function k(e){return w.apply(this,arguments)}function w(){return(w=Object(O.a)(u.a.mark((function e(t){var n,r,a,c,s,i,o,l,f,b,h,p,d,v,j,x,O,k;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new TextDecoder("utf-8"),e.next=3,Object(m.a)(fetch(t));case 3:return r=e.sent,e.next=6,Object(m.a)(r.blob());case 6:return a=e.sent,e.next=9,Object(m.a)(a.arrayBuffer());case 9:if(c=e.sent,s=Object(g.a)(new Uint8Array(c)),i=new Blob([s]),o=i.stream().getReader()){e.next=15;break}return e.abrupt("return");case 15:l=0,f=!1,b="";case 18:return e.next=21,Object(m.a)(o.read());case 21:if(h=e.sent,p=h.value,!h.done){e.next=26;break}return e.abrupt("break",76);case 26:d=p?n.decode(p):"",v=-1,j=[],x=0;case 30:if(!(x<d.length)){e.next=71;break}if(!f){e.next=35;break}'"'===d[x]?f=!1:"\\"===d[x]&&(x+=1),e.next=68;break;case 35:if('"'!==d[x]){e.next=39;break}f=!0,e.next=68;break;case 39:if("{"!==d[x]){e.next=44;break}0===l&&(v=x),l+=1,e.next=68;break;case 44:if("}"!==d[x]){e.next=68;break}if(0!==(l-=1)){e.next=68;break}if(!(v<0)){e.next=59;break}O=b+d.substring(0,x+1),e.prev=49,j.push(JSON.parse(b+d.substring(0,x+1))),e.next=57;break;case 53:return e.prev=53,e.t0=e.catch(49),console.log(O),e.abrupt("return");case 57:e.next=68;break;case 59:k=d.substring(v,x+1),e.prev=60,j.push(JSON.parse(d.substring(v,x+1))),e.next=68;break;case 64:return e.prev=64,e.t1=e.catch(60),console.log(k),e.abrupt("return");case 68:x++,e.next=30;break;case 71:return e.next=73,j;case 73:l>0&&(v<0?b+=d:b=d.substring(v)),e.next=18;break;case 76:case"end":return e.stop()}}),e,null,[[49,53],[60,64]])})))).apply(this,arguments)}var y=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r,a,c,s,i,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,r=!1,e.prev=2,c=u.a.mark((function e(){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o,r=t.transaction("allKanji","readwrite"),e.next=4,Promise.all(n.map((function(e){return r.store.put(e)})));case 4:return e.next=6,r.done;case 6:case"end":return e.stop()}}),e)})),s=Object(d.a)(k(j.a.join("/kamatama","dict/kanjidic2.json.gz")));case 5:return e.next=7,s.next();case 7:return i=e.sent,n=i.done,e.next=11,i.value;case 11:if(o=e.sent,n){e.next=17;break}return e.delegateYield(c(),"t0",14);case 14:n=!0,e.next=5;break;case 17:e.next=23;break;case 19:e.prev=19,e.t1=e.catch(2),r=!0,a=e.t1;case 23:if(e.prev=23,e.prev=24,n||null==s.return){e.next=28;break}return e.next=28,s.return();case 28:if(e.prev=28,!r){e.next=31;break}throw a;case 31:return e.finish(28);case 32:return e.finish(23);case 33:case"end":return e.stop()}}),e,null,[[2,19,23,33],[24,,28,32]])})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r,a,c,s,i,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,r=!1,e.prev=2,c=u.a.mark((function e(){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o,r=t.transaction(["allPhrases","queryStore"],"readwrite"),e.next=4,Promise.all([n.map((function(e){for(var t={sequenceNumber:e.sequenceNumber,exact:[],kana:[],partial:[]},n=0,a=[].concat(Object(p.a)(e.kanji),Object(p.a)(e.reading));n<a.length;n++){var c=a[n].value,s=Object(x.toHiragana)(c);t.exact.push(s);for(var i=1;i<s.length;i++)t.partial.push(s.substring(i))}return Promise.all([r.objectStore("allPhrases").put(e),r.objectStore("queryStore").put(t)])}))]);case 4:return e.next=6,r.done;case 6:case"end":return e.stop()}}),e)})),s=Object(d.a)(k(j.a.join("/kamatama","dict/JMdict.json.gz")));case 5:return e.next=7,s.next();case 7:return i=e.sent,n=i.done,e.next=11,i.value;case 11:if(o=e.sent,n){e.next=17;break}return e.delegateYield(c(),"t0",14);case 14:n=!0,e.next=5;break;case 17:e.next=23;break;case 19:e.prev=19,e.t1=e.catch(2),r=!0,a=e.t1;case 23:if(e.prev=23,e.prev=24,n||null==s.return){e.next=28;break}return e.next=28,s.return();case 28:if(e.prev=28,!r){e.next=31;break}throw a;case 31:return e.finish(28);case 32:return e.finish(23);case 33:case"end":return e.stop()}}),e,null,[[2,19,23,33],[24,,28,32]])})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],e.next=3,t.count("allKanji");case 3:if(e.t0=e.sent,!(e.t0<13108)){e.next=6;break}n.push(y(t));case 6:return e.next=8,t.count("allPhrases");case 8:if(e.t1=e.sent,!(e.t1<190269)){e.next=11;break}n.push(P(t));case 11:return e.next=13,Promise.all(n);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function S(){return(S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function N(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var q=a.createElement("g",null,a.createElement("circle",{id:"White",cx:512,cy:512,r:507,fill:"#ffffff",stroke:"#cccccc",strokeWidth:10}),a.createElement("circle",{id:"Yolk",cx:512,cy:512,r:200,fill:"#ffb43b"}));function R(e,t){var n=e.title,r=e.titleId,c=N(e,["title","titleId"]);return a.createElement("svg",S({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",ref:t,"aria-labelledby":r},c),n?a.createElement("title",{id:r},n):null,q)}var C=a.forwardRef(R),B=(n.p,n(32),function(){var e=Object(a.useState)(!0),t=Object(f.a)(e,2),n=t[0],c=t[1],s=Object(a.useState)(!1),i=Object(f.a)(s,2),o=i[0],b=i[1],p="serviceWorker"in navigator&&"indexedDB"in window,d=Object(a.useState)(null),v=Object(f.a)(d,2),j=v[0],x=v[1];Object(a.useEffect)((function(){p?h().then(function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.count("allKanji");case 2:return n=e.sent,e.next=5,t.count("allPhrases");case 5:r=e.sent,(n<13108||r<190269)&&c(!1);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()):c(!1)}),[p]),Object(a.useEffect)((function(){var e=function(e){e.preventDefault(),x(e)};return window.addEventListener("beforeinstallprompt",e),function(){window.removeEventListener("beforeinstallprompt",e)}}),[]);var m=Object(a.useCallback)((function(){n||!p||o||(b(!0),h().then((function(e){return E(e)})).then((function(){null!==j&&j.prompt(),c(!0)})))}),[j,n,p,o]);return Object(r.jsxs)("div",{className:["Landing",n&&"installed"].filter(Boolean).join(" "),children:[Object(r.jsxs)("div",{className:"content",children:[Object(r.jsx)("h1",{children:"\u3053\u3093\u306b\u3061\u306f!"}),Object(r.jsx)("p",{children:"This is Kamatama Jisho, a Japanese-English phrase book powered by the web!"}),p?Object(r.jsx)("p",{children:"To install Kamatama Jisho, just press the big egg down below."}):Object(r.jsxs)("p",{children:["Uh oh! The device you are using is not capable of installing"," ",Object(r.jsx)("a",{href:"https://en.wikipedia.org/wiki/Progressive_web_application",children:"PWAs"}),". Perhaps try a different device, or a different browser!"]})]}),p&&Object(r.jsx)("button",{className:"icon",children:Object(r.jsx)(C,{onClick:m})})]})}),W=n(20),A=n(21),I=n(4),L=new(function(){function e(){Object(W.a)(this,e),this.query=void 0,this.loadingResults=void 0,this.request=void 0,this.results=void 0,this.dbPromise=void 0,this.entry=void 0,this.currentEntry=void 0,Object(I.c)(this),this.query="",this.loadingResults=!1,this.results=[],this.request=0,this.entry=0,this.dbPromise=h()}return Object(A.a)(e,[{key:"setQuery",value:function(e){this.query=e instanceof Function?e(this.query):e,this.fetchResults(Object(x.toHiragana)(this.query,{passRomaji:!0}))}},{key:"setCurrentEntry",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r,a,c,s=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==t){e.next=3;break}return Object(I.d)((function(){s.currentEntry=void 0})),e.abrupt("return");case 3:return n=++this.entry,e.next=6,this.dbPromise;case 6:return r=e.sent,a=r.transaction("allPhrases"),e.next=10,a.store.get(t);case 10:c=e.sent,this.entry===n&&Object(I.d)((function(){s.currentEntry=c}));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchResults",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r,a,c,s,i=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==t){e.next=3;break}return Object(I.d)((function(){i.results=[]})),e.abrupt("return");case 3:return n=++this.request,r=new Set,e.next=7,this.fetchExactSequenceNumbers(t,r);case 7:return e.next=9,this.fetchPartialSequenceNumbers(t,r);case 9:return e.next=11,this.dbPromise;case 11:return a=e.sent,c=a.transaction("allPhrases"),s=[],e.next=16,Promise.all(Array.from(r).map(function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.store.get(t);case 2:n=e.sent,s.push(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 16:n===this.request&&Object(I.d)((function(){i.results=s}));case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchExactSequenceNumbers",value:function(){var e=Object(l.a)(u.a.mark((function e(t,n){var r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dbPromise;case 2:return r=e.sent,a=r.transaction("queryStore"),e.next=6,a.store.index("exact").getAll(t).then((function(e){e.forEach((function(e){var t=e.sequenceNumber;n.add(t)}))}));case 6:return e.next=8,a.done;case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchPartialSequenceNumbers",value:function(){var e=Object(l.a)(u.a.mark((function e(t,n){var r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dbPromise;case 2:return r=e.sent,a=r.transaction("queryStore"),e.next=6,Promise.all([a.store.index("exact").getAll(IDBKeyRange.bound(t,t+"\uffff"),30).then((function(e){e.forEach((function(e){var t=e.sequenceNumber;n.add(t)}))})),a.store.index("partial").getAll(IDBKeyRange.bound(t,t+"\uffff"),30).then((function(e){e.forEach((function(e){var t=e.sequenceNumber;n.add(t)}))}))]);case 6:return e.next=8,a.done;case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}()),J=n(7),K=(n(33),Object(i.a)((function(e){var t=e.sequenceNumber,n=e.reading,a=e.kanji,c=e.sense;return Object(r.jsxs)("li",{className:"ResultListItem",onClick:function(){L.setCurrentEntry(t),console.log(n[0].value)},children:[Object(r.jsx)("div",{className:"forms",children:[].concat(Object(p.a)(a),Object(p.a)(n)).sort((function(e,t){return e.priority.length-t.priority.length})).map((function(e){return e.value})).join("\u3001")}),Object(r.jsx)("div",{className:"meanings",children:c.flatMap((function(e){return e.glossary})).map((function(e){return e.value})).join(", ")})]})}))),T=Object(i.a)((function(){var e=L.results;return Object(r.jsx)("ul",{className:"ResultList",children:e.map((function(e){return Object(r.jsx)(K,Object(J.a)({},e),e.sequenceNumber)}))})})),D=n.p+"static/media/icon.b8f19d44.svg",U=(n(34),Object(i.a)((function(){var e=Object(a.useRef)(null);Object(a.useEffect)((function(){var t;null===(t=e.current)||void 0===t||t.focus()}),[]);var t=Object(a.useCallback)((function(e){L.setQuery(e.target.value)}),[]);return Object(r.jsxs)("div",{className:"SearchBar",children:[Object(r.jsx)("img",{className:"icon",src:D,alt:"icon"}),Object(r.jsx)("input",{ref:e,type:"text",value:L.query,onChange:t,placeholder:"Search here..."}),Object(r.jsx)("button",{className:"Radicals",children:"\u5b57"})]})}))),F=(n(35),n(36),Object(i.a)((function(){var e=L.currentEntry,t=Object(a.useRef)();Object(a.useEffect)((function(){t.current=e}),[e]);var n=e||t.current;return Object(r.jsxs)("div",{className:["Phrase",e&&"valid"].filter(Boolean).join(" "),children:[Object(r.jsx)("button",{onClick:function(){return L.setCurrentEntry(-1)},children:"close"}),Object(r.jsx)("pre",{children:JSON.stringify(n,null,2)})]})}))),M=Object(i.a)((function(){return Object(r.jsxs)("div",{className:"App",children:[Object(r.jsx)(B,{}),Object(r.jsx)(F,{}),Object(r.jsx)(U,{}),Object(r.jsx)(T,{results:L.results})]})})),Y=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,39)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),r(e),a(e),c(e),s(e)}))},z=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)),H=new Promise((function(e){window.addEventListener("load",(function t(){e(),window.removeEventListener("load",t)}))}));function Q(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}s.a.render(Object(r.jsx)(a.StrictMode,{children:Object(r.jsx)(M,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/kamatama",window.location.href).origin!==window.location.origin)return;H.then((function(){var t="".concat("/kamatama","/service-worker.js");z?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Q(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):Q(t,e)}))}}(),Y()}},[[37,1,2]]]);
//# sourceMappingURL=main.a7677bb0.chunk.js.map