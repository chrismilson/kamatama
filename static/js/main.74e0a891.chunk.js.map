{"version":3,"sources":["dictionary/index.ts","state/index.ts","ui/components/Results.tsx","ui/icon.svg","ui/components/SearchBar.tsx","ui/App.tsx","reportWebVitals.ts","index.tsx"],"names":["initDB","a","openDB","upgrade","db","_","version","console","log","allKanji","createObjectStore","keyPath","allPhrases","queryStore","createIndex","multiEntry","Promise","all","map","transaction","done","catch","error","store","query","loadingResults","results","request","dbPromise","makeAutoObservable","this","updateFactory","Function","fetchResults","runInAction","requestID","fetchSequenceNumbers","sequenceNumbers","tx","Array","from","number","get","entry","push","allSequenceNumbers","Set","index","getAll","IDBKeyRange","bound","then","forEach","reading","add","sequenceNumber","ResultListItem","kanji","sense","className","sort","b","priority","length","form","value","join","flatMap","meaning","glossary","ResultList","observer","result","SearchBar","inputRef","useRef","useEffect","current","focus","handleChange","useCallback","e","setQuery","target","src","icon","alt","ref","type","onChange","placeholder","App","reportWebVitals","onPerfEntry","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.74e0a891.chunk.js","sourcesContent":["import { openDB } from 'idb'\nimport { addDataIfNeeded } from './add-data'\n\nconst initDB = async () => {\n  const db = await openDB('kamatama', 1, {\n    upgrade: async (db, _, version) => {\n      console.log(`Upgrading database to version ${version}.`)\n\n      const allKanji = db.createObjectStore('allKanji', { keyPath: 'literal' })\n\n      const allPhrases = db.createObjectStore('allPhrases', {\n        keyPath: 'sequenceNumber'\n      })\n\n      const queryStore = db.createObjectStore('queryStore', {\n        keyPath: 'sequenceNumber'\n      })\n\n      queryStore.createIndex('queryStore', 'values', {\n        multiEntry: true\n      })\n\n      await Promise.all(\n        [allKanji, allPhrases, queryStore].map(\n          ({ transaction }) => transaction.done\n        )\n      ).catch(console.error)\n\n      console.log(`Database upgraded to version ${version}`)\n    }\n  })\n\n  if (process.env.NODE_ENV === 'development') {\n    addDataIfNeeded(db)\n  }\n\n  return db\n}\n\nexport default initDB\n","import { IDBPDatabase } from 'idb'\nimport { makeAutoObservable, runInAction } from 'mobx'\nimport initDB from '../dictionary'\nimport { JMEntry } from '../types/JMEntry'\n\n/**\n * Represents a store of the app's state.\n */\nexport class KamatamaJishoStore {\n  /** The current search query. */\n  query: string\n  loadingResults: boolean\n  results: JMEntry[]\n  request: number\n  dbPromise: Promise<IDBPDatabase>\n\n  constructor() {\n    makeAutoObservable(this)\n\n    this.query = ''\n    this.loadingResults = false\n    this.results = []\n    this.request = 0\n    this.dbPromise = initDB()\n  }\n\n  setQuery(updateFactory: string | ((priorQuery: string) => string)) {\n    if (updateFactory instanceof Function) {\n      this.query = updateFactory(this.query)\n    } else {\n      this.query = updateFactory\n    }\n    this.fetchResults()\n  }\n\n  private async fetchResults() {\n    if (this.query === '') {\n      runInAction(() => {\n        this.results = []\n      })\n      return\n    }\n\n    const requestID = ++this.request\n\n    const sequenceNumbers = await this.fetchSequenceNumbers()\n\n    const db = await this.dbPromise\n    const tx = db.transaction('allPhrases')\n\n    const results: JMEntry[] = []\n\n    await Promise.all(\n      Array.from(sequenceNumbers).map(async (number) => {\n        const entry = await tx.store.get(number)\n\n        results.push(entry)\n      })\n    )\n\n    if (requestID === this.request)\n      runInAction(() => {\n        this.results = results\n      })\n  }\n\n  private async fetchSequenceNumbers() {\n    const db = await this.dbPromise\n\n    const tx = db.transaction('queryStore')\n    const allSequenceNumbers = new Set<number>()\n\n    await tx.store\n      .index('queryStore')\n      .getAll(IDBKeyRange.bound(this.query, this.query + '\\uffff'), 50)\n      .then((results) => {\n        results.forEach((reading) => {\n          allSequenceNumbers.add(reading.sequenceNumber)\n        })\n      })\n\n    await tx.done\n\n    return allSequenceNumbers\n  }\n}\n\nconst store = new KamatamaJishoStore()\nexport default store\n","import { observer } from 'mobx-react-lite'\nimport { FC } from 'react'\nimport store from '../../state'\nimport { JMEntry } from '../../types/JMEntry'\nimport './Results.scss'\n\nconst ResultListItem: FC<JMEntry> = ({ reading, kanji, sense }) => {\n  return (\n    <li className=\"ResultListItem\">\n      <div className=\"forms\">\n        {[...kanji, ...reading]\n          .sort((a, b) => a.priority.length - b.priority.length)\n          .map((form) => form.value)\n          .join('、')}\n      </div>\n      <div className=\"meanings\">\n        {sense\n          .flatMap((meaning) => meaning.glossary)\n          .map((glossary) => glossary.value)\n          .join(', ')}\n      </div>\n    </li>\n  )\n}\n\n/**\n * A list of the results for the current query.\n */\nconst ResultList: FC<{\n  results: JMEntry[]\n}> = observer(() => {\n  const { results } = store\n\n  return (\n    <ul className=\"ResultList\">\n      {results.map((result) => (\n        <ResultListItem key={result.sequenceNumber} {...result} />\n      ))}\n    </ul>\n  )\n})\n\nexport default ResultList\n","export default __webpack_public_path__ + \"static/media/icon.b8f19d44.svg\";","import { ChangeEvent, FC, useCallback, useEffect, useRef } from 'react'\nimport { observer } from 'mobx-react-lite'\nimport store from '../../state'\nimport icon from '../icon.svg'\nimport './SearchBar.scss'\n\nconst SearchBar: FC = observer(() => {\n  const inputRef = useRef<HTMLInputElement>(null)\n\n  useEffect(() => {\n    inputRef.current?.focus()\n  }, [])\n\n  const handleChange = useCallback((e: ChangeEvent<HTMLInputElement>) => {\n    store.setQuery(e.target.value)\n  }, [])\n\n  return (\n    <div className=\"SearchBar\">\n      <img className=\"icon\" src={icon} alt=\"icon to open menu\" />\n      <input\n        ref={inputRef}\n        type=\"text\"\n        value={store.query}\n        onChange={handleChange}\n        placeholder=\"Search here...\"\n      />\n      <button className=\"Radicals\">字</button>\n    </div>\n  )\n})\n\nexport default SearchBar\n","import { FC } from 'react'\nimport ResultList from './components/Results'\nimport store from '../state'\nimport './App.css'\nimport { observer } from 'mobx-react-lite'\nimport SearchBar from './components/SearchBar'\n\nconst App: FC = observer(() => {\n  return (\n    <div className=\"App\">\n      <SearchBar />\n      <ResultList results={store.results} />\n    </div>\n  )\n})\n\nexport default App\n","import { ReportHandler } from 'web-vitals'\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry)\n      getFID(onPerfEntry)\n      getFCP(onPerfEntry)\n      getLCP(onPerfEntry)\n      getTTFB(onPerfEntry)\n    })\n  }\n}\n\nexport default reportWebVitals\n","import { StrictMode } from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './ui/App'\nimport reportWebVitals from './reportWebVitals'\n\nReactDOM.render(\n  <StrictMode>\n    <App />\n  </StrictMode>,\n  document.getElementById('root')\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n"],"sourceRoot":""}